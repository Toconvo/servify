<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>æ»¡æ„åº¦è¯„ä»· - Servify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --brand-primary: #4299e1;
      --brand-secondary: #764ba2;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-secondary) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .satisfaction-form {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      width: 100%;
      max-width: 600px;
      animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .form-header h1 {
      color: #2d3748;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .form-header p {
      color: #718096;
      font-size: 16px;
    }

    .ticket-info {
      background: #f7fafc;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      border-left: 4px solid var(--brand-primary);
    }

    .ticket-info h3 {
      color: #2d3748;
      margin-bottom: 8px;
    }

    .ticket-info p {
      color: #718096;
      margin: 4px 0;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .rating-container {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .star-rating {
      display: flex;
      gap: 4px;
    }

    .star {
      font-size: 32px;
      color: #e2e8f0;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .star:hover,
    .star.active {
      color: #f6ad55;
      transform: scale(1.1);
    }

    .rating-text {
      font-size: 14px;
      color: #718096;
      margin-left: 10px;
      font-weight: 500;
    }

    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      background: white;
      color: #2d3748;
      transition: border-color 0.2s ease;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand-primary) 20%, transparent);
    }

    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      resize: vertical;
      min-height: 120px;
      transition: border-color 0.2s ease;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand-primary) 20%, transparent);
    }

    .form-textarea::placeholder {
      color: #a0aec0;
    }

    .submit-button {
      width: 100%;
      background: linear-gradient(135deg, var(--brand-primary) 0%, color-mix(in srgb, var(--brand-primary) 70%, #000) 100%);
      color: white;
      border: none;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px color-mix(in srgb, var(--brand-primary) 35%, transparent);
    }

    .submit-button:active {
      transform: translateY(0);
    }

    .submit-button:disabled {
      background: #a0aec0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .success-message,
    .error-message {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
      text-align: center;
    }

    .success-message {
      background: #f0fff4;
      color: #22543d;
      border: 1px solid #9ae6b4;
    }

    .error-message {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
    }

    .loading {
      text-align: center;
      color: #718096;
      font-style: italic;
    }

    @media (max-width: 640px) {
      .satisfaction-form {
        padding: 30px 20px;
      }

      .form-header h1 {
        font-size: 24px;
      }

      .star {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <div class="satisfaction-form">
    <div class="form-header">
      <h1 id="page-h1">ğŸŒŸ å®¢æˆ·æ»¡æ„åº¦è¯„ä»·</h1>
      <p id="page-subtitle">æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œè¯·ä¸ºæœ¬æ¬¡æœåŠ¡ä½“éªŒæ‰“åˆ†</p>
    </div>

    <div id="loading" class="loading">
      <span id="loading-text">æ­£åœ¨åŠ è½½å·¥å•ä¿¡æ¯...</span>
    </div>

    <div id="error-message" class="error-message" style="display: none;"></div>

    <form id="satisfaction-form" style="display: none;">
      <div class="ticket-info">
        <h3 id="ticket-info-title">å·¥å•ä¿¡æ¯</h3>
        <p><strong id="lbl-ticket-title">å·¥å•æ ‡é¢˜:</strong> <span id="ticket-title">-</span></p>
        <p><strong id="lbl-ticket-id">å·¥å•ç¼–å·:</strong> #<span id="ticket-id">-</span></p>
        <p><strong id="lbl-agent-name">å¤„ç†å®¢æœ:</strong> <span id="agent-name">-</span></p>
        <p><strong id="lbl-resolved-time">è§£å†³æ—¶é—´:</strong> <span id="resolved-time">-</span></p>
      </div>

      <div class="form-group">
        <label for="rating"><span id="lbl-rating">æ•´ä½“æ»¡æ„åº¦</span> <span style="color: #e53e3e;">*</span></label>
        <div class="rating-container">
          <div class="star-rating" id="star-rating">
            <span class="star" data-rating="1">â˜…</span>
            <span class="star" data-rating="2">â˜…</span>
            <span class="star" data-rating="3">â˜…</span>
            <span class="star" data-rating="4">â˜…</span>
            <span class="star" data-rating="5">â˜…</span>
          </div>
          <span class="rating-text" id="rating-text">è¯·é€‰æ‹©è¯„åˆ†</span>
        </div>
      </div>

      <div class="form-group">
        <label for="category" id="lbl-category">è¯„ä»·ç±»å‹</label>
        <select id="category" class="form-select">
          <option value="overall">æ•´ä½“æ»¡æ„åº¦</option>
          <option value="service_quality">æœåŠ¡è´¨é‡</option>
          <option value="response_time">å“åº”é€Ÿåº¦</option>
          <option value="resolution_quality">é—®é¢˜è§£å†³è´¨é‡</option>
        </select>
      </div>

      <div class="form-group">
        <label for="comment" id="lbl-comment">è¯¦ç»†åé¦ˆ</label>
        <textarea
          id="comment"
          class="form-textarea"
          placeholder="è¯·åˆ†äº«æ‚¨å¯¹æœ¬æ¬¡æœåŠ¡çš„å…·ä½“æ„è§å’Œå»ºè®®ï¼Œæ‚¨çš„åé¦ˆå°†å¸®åŠ©æˆ‘ä»¬æŒç»­æ”¹è¿›æœåŠ¡è´¨é‡..."
        ></textarea>
      </div>

      <button type="submit" class="submit-button" id="submit-btn">
        æäº¤è¯„ä»·
      </button>
    </form>

    <div id="success-message" class="success-message" style="display: none;">
      <h3 id="success-title">ğŸ‰ æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼</h3>
      <p id="success-text">æ‚¨çš„è¯„ä»·å·²æˆåŠŸæäº¤ï¼Œæˆ‘ä»¬å°†è®¤çœŸå¯¹å¾…æ‚¨çš„æ¯ä¸€æ¡å»ºè®®ã€‚</p>
    </div>
  </div>

  <script>
    // è·å–URLå‚æ•°
    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // æ˜Ÿçº§è¯„åˆ†ç»„ä»¶
    class StarRating {
      constructor(container) {
        this.container = container;
        this.stars = container.querySelectorAll('.star');
        this.ratingText = document.getElementById('rating-text');
        this.currentRating = 0;
        this.ratingTexts = {};

        this.init();
      }

      init() {
        this.stars.forEach(star => {
          star.addEventListener('click', () => {
            this.setRating(parseInt(star.dataset.rating));
          });

          star.addEventListener('mouseenter', () => {
            this.highlightStars(parseInt(star.dataset.rating));
          });
        });

        this.container.addEventListener('mouseleave', () => {
          this.highlightStars(this.currentRating);
        });
      }

      setRating(rating) {
        this.currentRating = rating;
        this.highlightStars(rating);
        this.ratingText.textContent = this.ratingTexts[rating];
      }

      highlightStars(rating) {
        this.stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });
      }

      getRating() {
        return this.currentRating;
      }

      setRatingTexts(texts) {
        this.ratingTexts = texts || {};
        this.ratingText.textContent = this.ratingTexts[this.currentRating] || this.ratingTexts[0] || '';
      }
    }

    // API å®¢æˆ·ç«¯
    class ApiClient {
      constructor(baseUrl = '/api') {
        this.baseUrl = baseUrl;
      }

      async request(endpoint, options = {}) {
        const url = `${this.baseUrl}${endpoint}`;
        const response = await fetch(url, {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          ...options
        });

        if (!response.ok) {
          const error = await response.json().catch(() => ({ message: 'Network error' }));
          throw new Error(error.message || `HTTP ${response.status}`);
        }

        return response.json();
      }

      async getTicket(ticketId) {
        return this.request(`/tickets/${ticketId}`);
      }

      async getTicketSatisfaction(ticketId) {
        try {
          return await this.request(`/tickets/${ticketId}/satisfaction`);
        } catch (error) {
          if (error.message.includes('404')) {
            return null; // è¿˜æ²¡æœ‰è¯„ä»·
          }
          throw error;
        }
      }

      async createSatisfaction(data) {
        return this.request('/satisfactions', {
          method: 'POST',
          body: JSON.stringify(data)
        });
      }
    }

    // ä¸»åº”ç”¨
    class SatisfactionApp {
      constructor() {
        this.api = new ApiClient();
        this.publicApi = new ApiClient('/public');
        this.starRating = new StarRating(document.getElementById('star-rating'));
        this.ticketId = getUrlParameter('ticket_id');
        this.customerId = getUrlParameter('customer_id');
        this.surveyToken = getUrlParameter('token');
        this.lang = getUrlParameter('lang');

        this.loadingEl = document.getElementById('loading');
        this.errorMessageEl = document.getElementById('error-message');
        this.formEl = document.getElementById('satisfaction-form');
        this.successMessageEl = document.getElementById('success-message');

        this.init();
      }

      normalizeLocale(loc) {
        if (!loc) return '';
        loc = String(loc).trim();
        if (loc === 'zh' || loc === 'zh-CN') return 'zh-CN';
        if (loc === 'en' || loc === 'en-US') return 'en-US';
        return loc;
      }

      pickLocale(portal) {
        const urlLoc = this.normalizeLocale(this.lang);
        if (urlLoc && this.I18N[urlLoc]) return urlLoc;
        const portalLoc = this.normalizeLocale(portal?.default_locale);
        if (portalLoc && this.I18N[portalLoc]) return portalLoc;
        const navLoc = this.normalizeLocale(navigator.language || '');
        if (navLoc && this.I18N[navLoc]) return navLoc;
        return 'zh-CN';
      }

      async loadPortalConfig() {
        const res = await fetch('/public/portal/config', { headers: { Accept: 'application/json' } }).catch(() => null);
        if (!res || !res.ok) return null;
        return await res.json().catch(() => null);
      }

      applyBranding(portal) {
        if (!portal) return;
        const root = document.documentElement;
        if (portal.primary_color) root.style.setProperty('--brand-primary', portal.primary_color);
        if (portal.secondary_color) root.style.setProperty('--brand-secondary', portal.secondary_color);
      }

      applyI18n(portal) {
        const locale = this.pickLocale(portal);
        this.locale = locale;
        document.documentElement.lang = locale;
        const t = this.I18N[locale] || this.I18N['zh-CN'];
        const brand = portal?.brand_name || 'Servify';
        this.t = (k, vars = {}) => {
          const v = t[k];
          if (typeof v === 'function') return v(vars, brand, locale);
          return v || '';
        };
        document.title = this.t('title');
        document.getElementById('page-h1').textContent = this.t('pageH1');
        document.getElementById('page-subtitle').textContent = this.t('pageSubtitle');
        document.getElementById('loading-text').textContent = this.t('loading');
        document.getElementById('ticket-info-title').textContent = this.t('ticketInfo');
        document.getElementById('lbl-ticket-title').textContent = this.t('lblTicketTitle');
        document.getElementById('lbl-ticket-id').textContent = this.t('lblTicketId');
        document.getElementById('lbl-agent-name').textContent = this.t('lblAgentName');
        document.getElementById('lbl-resolved-time').textContent = this.t('lblResolvedTime');
        document.getElementById('lbl-rating').textContent = this.t('lblRating');
        document.getElementById('rating-text').textContent = this.t('rating0');
        document.getElementById('lbl-category').textContent = this.t('lblCategory');
        document.getElementById('lbl-comment').textContent = this.t('lblComment');
        document.getElementById('comment').placeholder = this.t('commentPh');
        document.getElementById('submit-btn').textContent = this.t('submit');
        document.getElementById('success-title').textContent = this.t('successTitle');
        document.getElementById('success-text').textContent = this.t('successText');
        const select = document.getElementById('category');
        const opt = (val) => select.querySelector(`option[value="${val}"]`);
        opt('overall').textContent = this.t('catOverall');
        opt('service_quality').textContent = this.t('catServiceQuality');
        opt('response_time').textContent = this.t('catResponseTime');
        opt('resolution_quality').textContent = this.t('catResolutionQuality');
        this.starRating.setRatingTexts({
          0: this.t('rating0'),
          1: this.t('rating1'),
          2: this.t('rating2'),
          3: this.t('rating3'),
          4: this.t('rating4'),
          5: this.t('rating5'),
        });
      }

      formatDate(dt) {
        if (!dt) return '-';
        try {
          return new Date(dt).toLocaleString(this.locale || undefined);
        } catch {
          return '-';
        }
      }

      async init() {
        this.I18N = {
          'zh-CN': {
            title: (_vars, brand) => `æ»¡æ„åº¦è¯„ä»· - ${brand}`,
            pageH1: 'ğŸŒŸ å®¢æˆ·æ»¡æ„åº¦è¯„ä»·',
            pageSubtitle: 'æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œè¯·ä¸ºæœ¬æ¬¡æœåŠ¡ä½“éªŒæ‰“åˆ†',
            loading: 'æ­£åœ¨åŠ è½½å·¥å•ä¿¡æ¯...',
            ticketInfo: 'å·¥å•ä¿¡æ¯',
            lblTicketTitle: 'å·¥å•æ ‡é¢˜:',
            lblTicketId: 'å·¥å•ç¼–å·:',
            lblAgentName: 'å¤„ç†å®¢æœ:',
            lblResolvedTime: 'è§£å†³æ—¶é—´:',
            lblRating: 'æ•´ä½“æ»¡æ„åº¦',
            rating0: 'è¯·é€‰æ‹©è¯„åˆ†',
            rating1: 'å¾ˆä¸æ»¡æ„',
            rating2: 'ä¸æ»¡æ„',
            rating3: 'ä¸€èˆ¬',
            rating4: 'æ»¡æ„',
            rating5: 'éå¸¸æ»¡æ„',
            lblCategory: 'è¯„ä»·ç±»å‹',
            catOverall: 'æ•´ä½“æ»¡æ„åº¦',
            catServiceQuality: 'æœåŠ¡è´¨é‡',
            catResponseTime: 'å“åº”é€Ÿåº¦',
            catResolutionQuality: 'é—®é¢˜è§£å†³è´¨é‡',
            lblComment: 'è¯¦ç»†åé¦ˆ',
            commentPh: 'è¯·åˆ†äº«æ‚¨å¯¹æœ¬æ¬¡æœåŠ¡çš„å…·ä½“æ„è§å’Œå»ºè®®ï¼Œæ‚¨çš„åé¦ˆå°†å¸®åŠ©æˆ‘ä»¬æŒç»­æ”¹è¿›æœåŠ¡è´¨é‡...',
            submit: 'æäº¤è¯„ä»·',
            submitting: 'æäº¤ä¸­...',
            errMissingParams: 'ç¼ºå°‘å¿…è¦å‚æ•°ï¼šå·¥å•IDæˆ–å®¢æˆ·ID',
            errLoadFailed: ({ message }) => `åŠ è½½å¤±è´¥ï¼š${message}`,
            errLoadSurveyFailed: ({ message }) => `æ— æ³•åŠ è½½è°ƒæŸ¥ä¿¡æ¯ï¼š${message}`,
            errPickRating: 'è¯·é€‰æ‹©æ»¡æ„åº¦è¯„åˆ†',
            errSubmitFailed: ({ message }) => `æäº¤å¤±è´¥ï¼š${message}`,
            alreadyRated: 'æ‚¨å·²ç»å¯¹æ­¤å·¥å•è¿›è¡Œè¿‡è¯„ä»·ï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆï¼',
            surveyCompleted: 'æ‚¨å·²å®Œæˆæ­¤æ¬¡è°ƒæŸ¥ï¼Œæ„Ÿè°¢å‚ä¸ï¼',
            surveyExpired: 'æŠ±æ­‰ï¼Œæœ¬æ¬¡è°ƒæŸ¥å·²è¿‡æœŸã€‚',
            successTitle: 'ğŸ‰ æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼',
            successText: 'æ‚¨çš„è¯„ä»·å·²æˆåŠŸæäº¤ï¼Œæˆ‘ä»¬å°†è®¤çœŸå¯¹å¾…æ‚¨çš„æ¯ä¸€æ¡å»ºè®®ã€‚',
            agentSystem: 'ç³»ç»Ÿå¤„ç†',
          },
          'en-US': {
            title: (_vars, brand) => `Satisfaction Survey - ${brand}`,
            pageH1: 'ğŸŒŸ Customer Satisfaction',
            pageSubtitle: 'Your feedback matters. Please rate your experience.',
            loading: 'Loading ticket information...',
            ticketInfo: 'Ticket',
            lblTicketTitle: 'Title:',
            lblTicketId: 'Ticket ID:',
            lblAgentName: 'Agent:',
            lblResolvedTime: 'Resolved at:',
            lblRating: 'Overall Rating',
            rating0: 'Select a rating',
            rating1: 'Very dissatisfied',
            rating2: 'Dissatisfied',
            rating3: 'Neutral',
            rating4: 'Satisfied',
            rating5: 'Very satisfied',
            lblCategory: 'Category',
            catOverall: 'Overall',
            catServiceQuality: 'Service quality',
            catResponseTime: 'Response time',
            catResolutionQuality: 'Resolution quality',
            lblComment: 'Feedback',
            commentPh: 'Share details about your experience...',
            submit: 'Submit',
            submitting: 'Submitting...',
            errMissingParams: 'Missing required parameters: ticket_id or customer_id',
            errLoadFailed: ({ message }) => `Load failed: ${message}`,
            errLoadSurveyFailed: ({ message }) => `Failed to load survey: ${message}`,
            errPickRating: 'Please select a rating',
            errSubmitFailed: ({ message }) => `Submit failed: ${message}`,
            alreadyRated: 'You have already submitted feedback for this ticket. Thank you!',
            surveyCompleted: 'You have already completed this survey. Thank you!',
            surveyExpired: 'Sorry, this survey has expired.',
            successTitle: 'ğŸ‰ Thanks for your feedback!',
            successText: 'Your response has been submitted successfully.',
            agentSystem: 'System',
          },
        };

        try {
          const portal = await this.loadPortalConfig();
          this.applyBranding(portal);
          this.applyI18n(portal);

          if (this.surveyToken) {
            await this.loadSurveyPreview();
            this.setupForm();
            this.showForm();
            return;
          }

          if (!this.ticketId || !this.customerId) {
            this.showError(this.t('errMissingParams'));
            return;
          }

          await this.loadTicketInfo();
          await this.checkExistingSatisfaction();
          this.setupForm();
          this.showForm();
        } catch (error) {
          // loadSurveyPreview å·²ç»å±•ç¤ºäº†é”™è¯¯ä¿¡æ¯
          if (!this.surveyToken) {
            this.showError(this.t('errLoadFailed', { message: error.message }));
          }
        }
      }

      async loadSurveyPreview() {
        try {
          const preview = await this.publicApi.request(`/csat/${this.surveyToken}`);
          this.ticketId = preview.ticket_id;
          document.getElementById('ticket-title').textContent = preview.ticket_title || '-';
          document.getElementById('ticket-id').textContent = preview.ticket_id || '-';
          document.getElementById('agent-name').textContent = preview.agent_name || this.t('agentSystem');
          document.getElementById('resolved-time').textContent = preview.resolved_at ? this.formatDate(preview.resolved_at) : '-';

          if (preview.status === 'completed') {
            this.showSuccess(this.t('surveyCompleted'));
            throw new Error('Survey completed');
          }
          if (preview.status === 'expired') {
            this.showError(this.t('surveyExpired'));
            throw new Error('Survey expired');
          }
        } catch (error) {
          if (error.message !== 'Survey completed' && error.message !== 'Survey expired') {
            this.showError(this.t('errLoadSurveyFailed', { message: error.message }));
          }
          throw error;
        }
      }

      async loadTicketInfo() {
        const ticket = await this.api.getTicket(this.ticketId);

        document.getElementById('ticket-title').textContent = ticket.title || '-';
        document.getElementById('ticket-id').textContent = ticket.id || '-';
        document.getElementById('agent-name').textContent = ticket.agent?.name || this.t('agentSystem');
        document.getElementById('resolved-time').textContent = ticket.resolved_at
          ? this.formatDate(ticket.resolved_at)
          : '-';

        this.ticketData = ticket;
      }

      async checkExistingSatisfaction() {
        const satisfaction = await this.api.getTicketSatisfaction(this.ticketId);
        if (satisfaction) {
          this.showSuccess(this.t('alreadyRated'));
          throw new Error('Already rated');
        }
      }

      setupForm() {
        const form = document.getElementById('satisfaction-form');
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          this.submitSatisfaction();
        });
      }

      async submitSatisfaction() {
        const submitBtn = document.getElementById('submit-btn');
        const rating = this.starRating.getRating();

        if (!rating) {
          this.showError(this.t('errPickRating'));
          return;
        }

        const comment = document.getElementById('comment').value.trim();
        const category = document.getElementById('category').value;

        try {
          submitBtn.disabled = true;
          submitBtn.textContent = this.t('submitting');

          if (this.surveyToken) {
            await this.publicApi.request(`/csat/${this.surveyToken}/respond`, {
              method: 'POST',
              body: JSON.stringify({ rating, comment })
            });
            this.showSuccess();
            return;
          }

          const data = {
            ticket_id: parseInt(this.ticketId),
            customer_id: parseInt(this.customerId),
            agent_id: this.ticketData.agent_id || null,
            rating,
            category,
            comment
          };

          await this.api.createSatisfaction(data);
          this.showSuccess();
        } catch (error) {
          this.showError(this.t('errSubmitFailed', { message: error.message }));
          submitBtn.disabled = false;
          submitBtn.textContent = this.t('submit');
        }
      }

      showForm() {
        this.loadingEl.style.display = 'none';
        this.formEl.style.display = 'block';
      }

      showError(message) {
        this.loadingEl.style.display = 'none';
        this.formEl.style.display = 'none';
        this.errorMessageEl.textContent = message;
        this.errorMessageEl.style.display = 'block';
      }

      showSuccess(message = null) {
        this.loadingEl.style.display = 'none';
        this.formEl.style.display = 'none';
        this.errorMessageEl.style.display = 'none';

        if (message) {
          this.successMessageEl.querySelector('p').textContent = message;
        }
        this.successMessageEl.style.display = 'block';
      }
    }

    // å¯åŠ¨åº”ç”¨
    document.addEventListener('DOMContentLoaded', () => {
      new SatisfactionApp();
    });
  </script>
</body>
</html>
