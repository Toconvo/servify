<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>Servify SDK Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; margin: 20px; }
    #log { border: 1px solid #ddd; padding: 10px; height: 280px; overflow: auto; background: #fafafa; }
    .row { margin-bottom: 10px; }
    input[type=text] { width: 70%; padding: 6px; }
    button { padding: 6px 10px; }
    .status { font-size: 12px; color: #666; }
  </style>
  <script src="/sdk/servify-sdk.umd.js"></script>
  <script>
    let client;
    function log(title, data) {
      const el = document.getElementById('log');
      const line = document.createElement('div');
      const text = `[${new Date().toLocaleTimeString()}] ${title}` + (data ? ' ' + (typeof data === 'string' ? data : JSON.stringify(data)) : '');
      line.textContent = text; el.appendChild(line); el.scrollTop = el.scrollHeight;
    }
    function connect() {
      const sessionId = document.getElementById('session').value || `sdk_${Date.now()}`;
      client = Servify.createClient({ sessionId });
      client.on('status', (s) => document.getElementById('status').textContent = s);
      client.on('open', () => log('已连接'));
      client.on('close', () => log('已关闭'));
      client.on('error', () => log('错误'));
      client.on('message', (m) => log('收到', m));
      client.on('ai', (m) => log('AI', m));
      client.connect();
    }
    function sendMsg() {
      if (!client) return log('未连接');
      const text = document.getElementById('msg').value;
      try { client.sendMessage(text); log('发送', { type: 'text-message', data: { content: text } }); }
      catch (e) { log('发送失败', e.message); }
    }
  </script>
</head>
<body>
  <h2>Servify SDK Demo <span class="status" id="status">idle</span></h2>
  <div class="row">会话ID: <input id="session" type="text" placeholder="留空则自动生成" /> <button onclick="connect()">连接</button></div>
  <div class="row">消息: <input id="msg" type="text" placeholder="输入要发送的文本" /> <button onclick="sendMsg()">发送</button></div>
  <div id="log"></div>
</body>
</html>
