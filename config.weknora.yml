# 更新后的配置文件 - 支持 WeKnora 集成

server:
  host: 0.0.0.0
  port: 8080

database:
  host: localhost
  port: 5432
  user: postgres
  password: password
  name: servify
  # 新增：连接池配置
  max_open_conns: 100
  max_idle_conns: 10
  conn_max_lifetime: 3600s

redis:
  host: localhost
  port: 6379
  password: ""
  db: 0
  # 新增：连接池配置
  pool_size: 10
  min_idle_conns: 5

# 现有 AI 配置
ai:
  openai:
    api_key: ""
    base_url: "https://api.openai.com/v1"
    model: "gpt-3.5-turbo"
    temperature: 0.7
    max_tokens: 1000
    timeout: 30s

# 新增：WeKnora 配置
weknora:
  enabled: true  # 是否启用 WeKnora
  base_url: "http://localhost:9000"
  api_key: "default-api-key"
  tenant_id: "default-tenant"
  knowledge_base_id: "default-kb"
  timeout: 30s
  max_retries: 3

  # 检索配置
  search:
    default_limit: 5
    score_threshold: 0.7
    strategy: "hybrid"  # "bm25", "vector", "hybrid", "graph"

  # 健康检查配置
  health_check:
    interval: 30s
    timeout: 10s

# 新增：降级策略配置
fallback:
  enabled: true
  legacy_kb_enabled: true

  # 熔断器配置
  circuit_breaker:
    enabled: true
    max_failures: 5
    reset_timeout: 60s
    half_open_max_requests: 3

# 现有配置
webrtc:
  stun_server: "stun:stun.l.google.com:19302"

jwt:
  secret: "default-secret-key"
  expires_in: "24h"

log:
  level: "info"
  format: "json"  # "json" or "text"
  output: "both"  # "stdout", "file", or "both"
  file_path: "./logs/servify.log"
  max_size: 100   # MB
  max_age: 7      # days
  max_backups: 3
  compress: true

# 新增：监控配置
monitoring:
  enabled: true
  metrics_path: "/metrics"

  # 性能指标
  performance:
    slow_query_threshold: 1s
    enable_request_logging: true

  # 健康检查
  health_checks:
    database: true
    redis: true
    weknora: true
    openai: false  # 可选，避免频繁调用

# 新增：安全配置
security:
  cors:
    enabled: true
    allowed_origins: ["*"]  # 生产环境应限制
    allowed_methods: ["GET", "POST", "PUT", "DELETE"]
    allowed_headers: ["*"]

  rate_limiting:
    enabled: true
    requests_per_minute: 60
    burst: 10

# 新增：文件上传配置（支持 WeKnora 文档上传）
upload:
  enabled: true
  max_file_size: "10MB"
  allowed_types: [".pdf", ".docx", ".txt", ".md", ".png", ".jpg", ".jpeg"]
  storage_path: "./uploads"

  # WeKnora 文档处理
  auto_process: true
  auto_index: true